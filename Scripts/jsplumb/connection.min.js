(function(){"use strict";var t=function(n,t,i,r,u){if(!n.Defaults.DoNotThrowErrors&&jsPlumb.Connectors[t][i]==null)throw{msg:"jsPlumb: unknown connector type '"+i+"'"};return new jsPlumb.Connectors[t][i](r,u)},n=function(n,t,i){return n?i.makeAnchor(n,t,i):null};jsPlumb.Connection=function(n){var w=n.newEndpoint,c=jsPlumbUtil,t,e,o,l,f,h;if(this.connector=null,this.idPrefix="_jsplumb_c_",this.defaultLabelLocation=.5,this.defaultOverlayKeys=["Overlays","ConnectionOverlays"],this.previousConnection=n.previousConnection,this.source=jsPlumb.getDOMElement(n.source),this.target=jsPlumb.getDOMElement(n.target),n.sourceEndpoint&&(this.source=n.sourceEndpoint.endpointWillMoveTo||n.sourceEndpoint.getElement()),n.targetEndpoint&&(this.target=n.targetEndpoint.getElement()),OverlayCapableJsPlumbUIComponent.apply(this,arguments),this.sourceId=this._jsPlumb.instance.getId(this.source),this.targetId=this._jsPlumb.instance.getId(this.target),this.scope=n.scope,this.endpoints=[],this.endpointStyles=[],t=this._jsPlumb.instance,t.manage(this.sourceId,this.source),t.manage(this.targetId,this.target),this._jsPlumb.visible=!0,this._jsPlumb.editable=n.editable===!0,this._jsPlumb.params={cssClass:n.cssClass,container:n.container,"pointer-events":n["pointer-events"],editorParams:n.editorParams},this._jsPlumb.lastPaintedAt=null,this.getDefaultType=function(){return{parameters:{},scope:null,detachable:this._jsPlumb.instance.Defaults.ConnectionsDetachable,rettach:this._jsPlumb.instance.Defaults.ReattachConnections,paintStyle:this._jsPlumb.instance.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,connector:this._jsPlumb.instance.Defaults.Connector||jsPlumb.Defaults.Connector,hoverPaintStyle:this._jsPlumb.instance.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,overlays:this._jsPlumb.instance.Defaults.ConnectorOverlays||jsPlumb.Defaults.ConnectorOverlays}},this.bind("mouseover",function(){this.setHover(!0)}.bind(this)),this.bind("mouseout",function(){this.setHover(!1)}.bind(this)),this.makeEndpoint=function(i,r,u,f){return u=u||this._jsPlumb.instance.getId(r),this.prepareEndpoint(t,w,this,f,i?0:1,n,r,u)},e=this.makeEndpoint(!0,this.source,this.sourceId,n.sourceEndpoint),o=this.makeEndpoint(!1,this.target,this.targetId,n.targetEndpoint),e&&c.addToList(n.endpointsByElement,this.sourceId,e),o&&c.addToList(n.endpointsByElement,this.targetId,o),this.scope||(this.scope=this.endpoints[0].scope),n.deleteEndpointsOnDetach!=null?(this.endpoints[0]._deleteOnDetach=n.deleteEndpointsOnDetach,this.endpoints[1]._deleteOnDetach=n.deleteEndpointsOnDetach):(this.endpoints[0]._doNotDeleteOnDetach||(this.endpoints[0]._deleteOnDetach=!0),this.endpoints[1]._doNotDeleteOnDetach||(this.endpoints[1]._deleteOnDetach=!0)),this.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||n.connector||t.Defaults.Connector||jsPlumb.Defaults.Connector,!0,!0),n.path&&this.connector.setPath(n.path),this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||n.paintStyle||t.Defaults.PaintStyle||jsPlumb.Defaults.PaintStyle,!0),this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||n.hoverPaintStyle||t.Defaults.HoverPaintStyle||jsPlumb.Defaults.HoverPaintStyle,!0),this._jsPlumb.paintStyleInUse=this.getPaintStyle(),l=t.getSuspendedAt(),!t.isSuspendDrawing()){var a=t.getCachedData(this.sourceId),i=a.o,v=a.s,y=t.getCachedData(this.targetId),r=y.o,p=y.s,u=l||t.timestamp(),s=this.endpoints[0].anchor.compute({xy:[i.left,i.top],wh:v,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[r.left,r.top],twh:p,tElement:this.endpoints[1],timestamp:u});this.endpoints[0].paint({anchorLoc:s,timestamp:u});s=this.endpoints[1].anchor.compute({xy:[r.left,r.top],wh:p,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[i.left,i.top],twh:v,tElement:this.endpoints[0],timestamp:u});this.endpoints[1].paint({anchorLoc:s,timestamp:u})}this._jsPlumb.detachable=t.Defaults.ConnectionsDetachable;n.detachable===!1&&(this._jsPlumb.detachable=!1);this.endpoints[0].connectionsDetachable===!1&&(this._jsPlumb.detachable=!1);this.endpoints[1].connectionsDetachable===!1&&(this._jsPlumb.detachable=!1);this._jsPlumb.reattach=n.reattach||this.endpoints[0].reattachConnections||this.endpoints[1].reattachConnections||t.Defaults.ReattachConnections;this._jsPlumb.cost=n.cost||this.endpoints[0].getConnectionCost();this._jsPlumb.directed=n.directed;n.directed==null&&(this._jsPlumb.directed=this.endpoints[0].areConnectionsDirected());f=jsPlumb.extend({},this.endpoints[1].getParameters());jsPlumb.extend(f,this.endpoints[0].getParameters());jsPlumb.extend(f,this.getParameters());this.setParameters(f);h=[n.type,this.endpoints[0].connectionType,this.endpoints[1].connectionType].join(" ");/[^\s]/.test(h)&&this.addType(h,n.data,!0)};jsPlumbUtil.extend(jsPlumb.Connection,OverlayCapableJsPlumbUIComponent,{applyType:function(n,t){n.detachable!=null&&this.setDetachable(n.detachable);n.reattach!=null&&this.setReattach(n.reattach);n.scope&&(this.scope=n.scope);this.setConnector(n.connector,t);n.cssClass!=null&&this.canvas&&this._jsPlumb.instance.addClass(this.canvas,n.cssClass);n.anchor?(this.endpoints[0].anchor=this._jsPlumb.instance.makeAnchor(n.anchor),this.endpoints[1].anchor=this._jsPlumb.instance.makeAnchor(n.anchor)):n.anchors&&(this.endpoints[0].anchor=this._jsPlumb.instance.makeAnchor(n.anchors[0]),this.endpoints[1].anchor=this._jsPlumb.instance.makeAnchor(n.anchors[1]))},getTypeDescriptor:function(){return"connection"},getAttachedElements:function(){return this.endpoints},addClass:function(n,t){t&&(this.endpoints[0].addClass(n),this.endpoints[1].addClass(n),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(n));this.connector&&this.connector.addClass(n)},removeClass:function(n,t){t&&(this.endpoints[0].removeClass(n),this.endpoints[1].removeClass(n),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(n));this.connector&&this.connector.removeClass(n)},isVisible:function(){return this._jsPlumb.visible},setVisible:function(n){this._jsPlumb.visible=n;this.connector&&this.connector.setVisible(n);this.repaint()},cleanup:function(){this.endpoints=null;this.source=null;this.target=null;this.connector!=null&&(this.connector.cleanup(),this.connector.destroy());this.connector=null},isDetachable:function(){return this._jsPlumb.detachable===!0},setDetachable:function(n){this._jsPlumb.detachable=n===!0},isReattach:function(){return this._jsPlumb.reattach===!0},setReattach:function(n){this._jsPlumb.reattach=n===!0},setHover:function(n){this.connector&&this._jsPlumb&&!this._jsPlumb.instance.isConnectionBeingDragged()&&(this.connector.setHover(n),jsPlumbAdapter[n?"addClass":"removeClass"](this.source,this._jsPlumb.instance.hoverSourceClass),jsPlumbAdapter[n?"addClass":"removeClass"](this.target,this._jsPlumb.instance.hoverTargetClass))},getCost:function(){return this._jsPlumb.cost},setCost:function(n){this._jsPlumb.cost=n},isDirected:function(){return this._jsPlumb.directed===!0},getConnector:function(){return this.connector},setConnector:function(n,i,r){var e=jsPlumbUtil,u,f;this.connector!=null&&(this.connector.cleanup(),this.connector.destroy());u={_jsPlumb:this._jsPlumb.instance,cssClass:this._jsPlumb.params.cssClass,container:this._jsPlumb.params.container,"pointer-events":this._jsPlumb.params["pointer-events"]};f=this._jsPlumb.instance.getRenderMode();e.isString(n)?this.connector=t(this._jsPlumb.instance,f,n,u,this):e.isArray(n)&&(this.connector=n.length==1?t(this._jsPlumb.instance,f,n[0],u,this):t(this._jsPlumb.instance,f,n[0],e.merge(n[1],u),this));this.canvas=this.connector.canvas;this.bgCanvas=this.connector.bgCanvas;this.canvas&&(this.canvas._jsPlumb=this);this.bgCanvas&&(this.bgCanvas._jsPlumb=this);r||this.setListenerComponent(this.connector);i||this.repaint()},paint:function(n){var t,i,s,e,l;if(!this._jsPlumb.instance.isSuspendDrawing()&&this._jsPlumb.visible){n=n||{};var r=n.timestamp,o=!1,b=o?this.sourceId:this.targetId,k=o?this.targetId:this.sourceId,a=o?0:1,v=o?1:0;if(r==null||r!=this._jsPlumb.lastPaintedAt){var u=this._jsPlumb.instance.getOffset(k),f=this._jsPlumb.instance.getOffset(b),y=this.endpoints[v],p=this.endpoints[a],d=y.anchor.getCurrentLocation({xy:[u.left,u.top],wh:[u.width,u.height],element:y,timestamp:r}),g=p.anchor.getCurrentLocation({xy:[f.left,f.top],wh:[f.width,f.height],element:p,timestamp:r});for(this.connector.resetBounds(),this.connector.compute({sourcePos:d,targetPos:g,sourceEndpoint:this.endpoints[v],targetEndpoint:this.endpoints[a],lineWidth:this._jsPlumb.paintStyleInUse.lineWidth,sourceInfo:u,targetInfo:f}),t={minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity},i=0;i<this._jsPlumb.overlays.length;i++)s=this._jsPlumb.overlays[i],s.isVisible()&&(this._jsPlumb.overlayPlacements[i]=s.draw(this.connector,this._jsPlumb.paintStyleInUse,this.getAbsoluteOverlayPosition(s)),t.minX=Math.min(t.minX,this._jsPlumb.overlayPlacements[i].minX),t.maxX=Math.max(t.maxX,this._jsPlumb.overlayPlacements[i].maxX),t.minY=Math.min(t.minY,this._jsPlumb.overlayPlacements[i].minY),t.maxY=Math.max(t.maxY,this._jsPlumb.overlayPlacements[i].maxY));var h=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||1)/2,c=parseFloat(this._jsPlumb.paintStyleInUse.lineWidth||0),w={xmin:Math.min(this.connector.bounds.minX-(h+c),t.minX),ymin:Math.min(this.connector.bounds.minY-(h+c),t.minY),xmax:Math.max(this.connector.bounds.maxX+(h+c),t.maxX),ymax:Math.max(this.connector.bounds.maxY+(h+c),t.maxY)};for(this.connector.paint(this._jsPlumb.paintStyleInUse,null,w),e=0;e<this._jsPlumb.overlays.length;e++)l=this._jsPlumb.overlays[e],l.isVisible()&&l.paint(this._jsPlumb.overlayPlacements[e],w)}this._jsPlumb.lastPaintedAt=r}},repaint:function(n){n=n||{};this.paint({elId:this.sourceId,recalc:!(n.recalc===!1),timestamp:n.timestamp})},prepareEndpoint:function(t,i,r,u,f,e,o,s){var l,a,h,c,v,y;return u?(r.endpoints[f]=u,u.addConnection(r)):(e.endpoints||(e.endpoints=[null,null]),a=e.endpoints[f]||e.endpoint||t.Defaults.Endpoints[f]||jsPlumb.Defaults.Endpoints[f]||t.Defaults.Endpoint||jsPlumb.Defaults.Endpoint,e.endpointStyles||(e.endpointStyles=[null,null]),e.endpointHoverStyles||(e.endpointHoverStyles=[null,null]),h=e.endpointStyles[f]||e.endpointStyle||t.Defaults.EndpointStyles[f]||jsPlumb.Defaults.EndpointStyles[f]||t.Defaults.EndpointStyle||jsPlumb.Defaults.EndpointStyle,h.fillStyle==null&&e.paintStyle!=null&&(h.fillStyle=e.paintStyle.strokeStyle),h.outlineColor==null&&e.paintStyle!=null&&(h.outlineColor=e.paintStyle.outlineColor),h.outlineWidth==null&&e.paintStyle!=null&&(h.outlineWidth=e.paintStyle.outlineWidth),c=e.endpointHoverStyles[f]||e.endpointHoverStyle||t.Defaults.EndpointHoverStyles[f]||jsPlumb.Defaults.EndpointHoverStyles[f]||t.Defaults.EndpointHoverStyle||jsPlumb.Defaults.EndpointHoverStyle,e.hoverPaintStyle!=null&&(c==null&&(c={}),c.fillStyle==null&&(c.fillStyle=e.hoverPaintStyle.strokeStyle)),v=e.anchors?e.anchors[f]:e.anchor?e.anchor:n(t.Defaults.Anchors[f],s,t)||n(jsPlumb.Defaults.Anchors[f],s,t)||n(t.Defaults.Anchor,s,t)||n(jsPlumb.Defaults.Anchor,s,t),y=e.uuids?e.uuids[f]:null,l=i({paintStyle:h,hoverPaintStyle:c,endpoint:a,connections:[r],uuid:y,anchor:v,source:o,scope:e.scope,reattach:e.reattach||t.Defaults.ReattachConnections,detachable:e.detachable||t.Defaults.ConnectionsDetachable}),r.endpoints[f]=l,e.drawEndpoints===!1&&l.setVisible(!1,!0,!0)),l}})})();
//# sourceMappingURL=connection.min.js.map
