(function(){"use strict";var i,n,t;jsPlumb.AnchorManager=function(n){var r={},h={},e={},a={},p={HORIZONTAL:"horizontal",VERTICAL:"vertical",DIAGONAL:"diagonal",IDENTITY:"identity"},f=["left","top","right","bottom"],t={},o=this,i={},u=n.jsPlumbInstance,l={},w=function(n,t,i,r,u,e){var h,c,l,a,s;if(n===t)return{orientation:p.IDENTITY,a:["top","top"]};var y=Math.atan2(r.centery-i.centery,r.centerx-i.centerx),w=Math.atan2(i.centery-r.centery,i.centerx-r.centerx),o=[],v={};for(function(n,t){for(var i=0;i<n.length;i++)v[n[i]]={left:[t[i].left,t[i].centery],right:[t[i].right,t[i].centery],top:[t[i].centerx,t[i].top],bottom:[t[i].centerx,t[i].bottom]}}(["source","target"],[i,r]),h=0;h<f.length;h++)for(c=0;c<f.length;c++)h!=c&&o.push({source:f[h],target:f[c],dist:Biltong.lineLength(v.source[f[h]],v.target[f[c]])});for(o.sort(function(n,t){return n.dist<t.dist?-1:n.dist>t.dist?1:0}),l=o[0].source,a=o[0].target,s=0;s<o.length;s++)if(l=!u.isContinuous||u.isEdgeSupported(o[s].source)?o[s].source:null,a=!e.isContinuous||e.isEdgeSupported(o[s].target)?o[s].target:null,l!=null&&a!=null)break;return{a:[l,a],theta:y,theta2:w}},b=function(n,t,i,r,u,f,e){for(var s,h,c=[],v=t[u?0:1]/(r.length+1),o=0;o<r.length;o++){s=(o+1)*v;h=f*t[u?1:0];e&&(s=t[u?0:1]-s);var l=u?s:h,y=i[0]+l,p=l/t[0],a=u?h:s,w=i[1]+a,b=a/t[1];c.push([y,w,p,b,r[o][1],r[o][2]])}return c},v=function(n){return function(t,i){var r=!0;return r=n?t[0][0]<i[0][0]:t[0][0]>i[0][0],r===!1?-1:1}},k=function(n,t){var i=n[0][0]<0?-Math.PI-n[0][0]:Math.PI-n[0][0],r=t[0][0]<0?-Math.PI-t[0][0]:Math.PI-t[0][0];return i>r?1:n[0][1]>t[0][1]?1:-1},d={top:function(n,t){return n[0]>t[0]?1:-1},right:v(!0),bottom:v(!0),left:k},g=function(n,t){return n.sort(t)},nt=function(n,t){var e=u.getCachedData(n),r=e.s,i=e.o,f=function(t,i,r,u,f,e,o){var s;if(u.length>0){var y=g(u,d[t]),p=t==="right"||t==="top",c=b(t,i,r,y,f,e,p),v=function(n,t){h[n.id]=[t[0],t[1],t[2],t[3]];a[n.id]=o};for(s=0;s<c.length;s++){var l=c[s][4],w=l.endpoints[0].elementId===n,k=l.endpoints[1].elementId===n;w?v(l.endpoints[0],c[s]):k&&v(l.endpoints[1],c[s])}}};f("bottom",r,[i.left,i.top],t.bottom,!0,1,[0,1]);f("top",r,[i.left,i.top],t.top,!0,0,[0,-1]);f("left",r,[i.left,i.top],t.left,!1,0,[-1,0]);f("right",r,[i.left,i.top],t.right,!1,1,[1,0])},c,s,y;this.reset=function(){r={};t={};i={}};this.addFloatingConnection=function(n,t){l[n]=t};this.removeFloatingConnection=function(n){delete l[n]};this.newConnection=function(n){var r=n.sourceId,u=n.targetId,i=n.endpoints,f=!0,e=function(e,o,s,h,c){r==u&&s.isContinuous&&(n._jsPlumb.instance.removeElement(i[1].canvas),f=!1);jsPlumbUtil.addToList(t,h,[c,o,s.constructor==jsPlumb.DynamicAnchor])};e(0,i[0],i[0].anchor,u,n);f&&e(1,i[1],i[1].anchor,r,n)};c=function(n){(function(n,t){if(n){var i=function(n){return n[4]==t};jsPlumbUtil.removeWithFunction(n.top,i);jsPlumbUtil.removeWithFunction(n.left,i);jsPlumbUtil.removeWithFunction(n.bottom,i);jsPlumbUtil.removeWithFunction(n.right,i)}})(i[n.elementId],n.id)};this.connectionDetached=function(n){var i=n.connection||n,f=n.sourceId,e=n.targetId,r=i.endpoints,u=function(n,i,r,u,f){r!=null&&r.constructor==jsPlumb.FloatingAnchor||jsPlumbUtil.removeWithFunction(t[u],function(n){return n[0].id==f.id})};u(1,r[1],r[1].anchor,f,i);u(0,r[0],r[0].anchor,e,i);c(i.endpoints[0]);c(i.endpoints[1]);o.redraw(i.sourceId);o.redraw(i.targetId)};this.add=function(n,t){jsPlumbUtil.addToList(r,t,n)};this.changeId=function(n,i){t[i]=t[n];r[i]=r[n];delete t[n];delete r[n]};this.getConnectionsFor=function(n){return t[n]||[]};this.getEndpointsFor=function(n){return r[n]||[]};this.deleteEndpoint=function(n){jsPlumbUtil.removeWithFunction(r[n.elementId],function(t){return t.id==n.id});c(n)};this.clearFor=function(n){delete r[n];r[n]=[]};s=function(t,i,r,u,f,e,o,s,h,c,l,a){var g=-1,w=-1,b=u.endpoints[o],nt=b.id,k=[1,0][o],tt=[[i,r],u,f,e,nt],y=t[h],p=b._continuousAnchorEdge?t[b._continuousAnchorEdge]:null,v,d,it;if(p&&(d=jsPlumbUtil.findWithFunction(p,function(n){return n[4]==nt}),d!=-1))for(p.splice(d,1),v=0;v<p.length;v++)jsPlumbUtil.addWithFunction(l,p[v][1],function(n){return n.id==p[v][1].id}),jsPlumbUtil.addWithFunction(a,p[v][1].endpoints[o],function(n){return n.id==p[v][1].endpoints[o].id}),jsPlumbUtil.addWithFunction(a,p[v][1].endpoints[k],function(n){return n.id==p[v][1].endpoints[k].id});for(v=0;v<y.length;v++)n.idx==1&&y[v][3]===e&&w==-1&&(w=v),jsPlumbUtil.addWithFunction(l,y[v][1],function(n){return n.id==y[v][1].id}),jsPlumbUtil.addWithFunction(a,y[v][1].endpoints[o],function(n){return n.id==y[v][1].endpoints[o].id}),jsPlumbUtil.addWithFunction(a,y[v][1].endpoints[k],function(n){return n.id==y[v][1].endpoints[k].id});g!=-1?y[g]=tt:(it=s?w!=-1?w:0:y.length,y.splice(it,0,tt));b._continuousAnchorEdge=h};this.updateOtherEndpoint=function(n,i,r,u){var f=jsPlumbUtil.findWithFunction(t[n],function(n){return n[0].id===u.id}),e=jsPlumbUtil.findWithFunction(t[i],function(n){return n[0].id===u.id});f!=-1&&(t[n][f][0]=u,t[n][f][1]=u.endpoints[1],t[n][f][2]=u.endpoints[1].anchor.constructor==jsPlumb.DynamicAnchor);e>-1&&(t[i].splice(e,1),jsPlumbUtil.addToList(t,r,[u,u.endpoints[0],u.endpoints[0].anchor.constructor==jsPlumb.DynamicAnchor]))};this.sourceChanged=function(n,i,r){if(n!==i){jsPlumbUtil.removeWithFunction(t[n],function(n){return n[0].id===r.id});var u=jsPlumbUtil.findWithFunction(t[r.targetId],function(n){return n[0].id===r.id});u>-1&&(t[r.targetId][u][0]=r,t[r.targetId][u][1]=r.endpoints[0],t[r.targetId][u][2]=r.endpoints[0].anchor.constructor==jsPlumb.DynamicAnchor);jsPlumbUtil.addToList(t,i,[r,r.endpoints[1],r.endpoints[1].anchor.constructor==jsPlumb.DynamicAnchor])}};this.rehomeEndpoint=function(n,t,i){var s=r[t]||[],h=u.getId(i),e,c,f;for(h!==t&&(e=jsPlumbUtil.indexOf(s,n),e>-1&&(c=s.splice(e,1)[0],o.add(c,h))),f=0;f<n.connections.length;f++)n.connections[f].sourceId==t?(n.connections[f].sourceId=n.elementId,n.connections[f].source=n.element,o.sourceChanged(t,n.elementId,n.connections[f])):n.connections[f].targetId==t&&(n.connections[f].targetId=n.elementId,n.connections[f].target=n.element,o.updateOtherEndpoint(n.connections[f].sourceId,t,n.elementId,n.connections[f]))};this.redraw=function(n,f,e,o,h,c){var st,ht,a,vt,yt,ct,tt,et,lt;if(!u.isSuspendDrawing()){var d=r[n]||[],k=t[n]||[],b=[],g=[],rt=[];for(e=e||u.timestamp(),o=o||{left:0,top:0},f&&(f={left:f.left+o.left,top:f.top+o.top}),st=u.updateOffset({elId:n,offset:f,recalc:!1,timestamp:e}),ht={},a=0;a<k.length;a++){var p=k[a][0],v=p.sourceId,y=p.targetId,ut=p.endpoints[0].anchor.isContinuous,ft=p.endpoints[1].anchor.isContinuous;if(ut||ft){var at=v+"_"+y,pt=y+"_"+v,it=ht[at],ot=p.sourceId==n?1:0;ut&&!i[v]&&(i[v]={top:[],right:[],bottom:[],left:[]});ft&&!i[y]&&(i[y]={top:[],right:[],bottom:[],left:[]});n!=y&&u.updateOffset({elId:y,timestamp:e});n!=v&&u.updateOffset({elId:v,timestamp:e});vt=u.getCachedData(y);yt=u.getCachedData(v);y==v&&(ut||ft)?s(i[v],-Math.PI/2,0,p,!1,y,0,!1,"top",v,b,g):(it||(it=w(v,y,yt.o,vt.o,p.endpoints[0].anchor,p.endpoints[1].anchor),ht[at]=it),ut&&s(i[v],it.theta,0,p,!1,y,0,!1,it.a[0],v,b,g),ft&&s(i[y],it.theta2,-1,p,!0,v,1,!0,it.a[1],y,b,g));ut&&jsPlumbUtil.addWithFunction(rt,v,function(n){return n===v});ft&&jsPlumbUtil.addWithFunction(rt,y,function(n){return n===y});jsPlumbUtil.addWithFunction(b,p,function(n){return n.id==p.id});(ut&&ot===0||ft&&ot===1)&&jsPlumbUtil.addWithFunction(g,p.endpoints[ot],function(n){return n.id==p.endpoints[ot].id})}}for(a=0;a<d.length;a++)d[a].connections.length===0&&d[a].anchor.isContinuous&&(i[n]||(i[n]={top:[],right:[],bottom:[],left:[]}),s(i[n],-Math.PI/2,0,{endpoints:[d[a],d[a]],paint:function(){}},!1,n,0,!1,d[a].anchor.getDefaultFace(),n,b,g),jsPlumbUtil.addWithFunction(rt,n,function(t){return t===n}));for(a=0;a<rt.length;a++)nt(rt[a],i[rt[a]]);for(a=0;a<d.length;a++)d[a].paint({timestamp:e,offset:st,dimensions:st.s,recalc:c!==!0});for(a=0;a<g.length;a++)ct=u.getCachedData(g[a].elementId),g[a].paint({timestamp:e,offset:ct,dimensions:ct.s});for(a=0;a<k.length;a++)if(tt=k[a][1],tt.anchor.constructor==jsPlumb.DynamicAnchor)for(tt.paint({elementWithPrecedence:n,timestamp:e}),jsPlumbUtil.addWithFunction(b,k[a][0],function(n){return n.id==k[a][0].id}),et=0;et<tt.connections.length;et++)tt.connections[et]!==k[a][0]&&jsPlumbUtil.addWithFunction(b,tt.connections[et],function(n){return n.id==tt.connections[et].id});else tt.anchor.constructor==jsPlumb.Anchor&&jsPlumbUtil.addWithFunction(b,k[a][0],function(n){return n.id==k[a][0].id});for(lt=l[n],lt&&lt.paint({timestamp:e,recalc:!1,elId:n}),a=0;a<b.length;a++)b[a].paint({elId:n,timestamp:e,recalc:!1,clearEdits:h})}};y=function(n){var r;jsPlumbUtil.EventGenerator.apply(this);this.type="Continuous";this.isDynamic=!0;this.isContinuous=!0;var i=n.faces||["top","right","bottom","left"],u=!(n.clockwise===!1),t={},f={top:"bottom",right:"left",left:"right",bottom:"top"},o={top:"right",right:"bottom",left:"top",bottom:"left"},s={top:"left",right:"top",left:"bottom",bottom:"right"},c=u?o:s,l=u?s:o,v=n.cssClass||"";for(r=0;r<i.length;r++)t[i[r]]=!0;this.getDefaultFace=function(){return i.length===0?"top":i[0]};this.verifyEdge=function(n){return t[n]?n:t[f[n]]?f[n]:t[c[n]]?c[n]:t[l[n]]?l[n]:n};this.isEdgeSupported=function(n){return t[n]===!0};this.compute=function(n){return e[n.element.id]||h[n.element.id]||[0,0]};this.getCurrentLocation=function(n){return e[n.element.id]||h[n.element.id]||[0,0]};this.getOrientation=function(n){return a[n.id]||[0,0]};this.clearUserDefinedLocation=function(){delete e[n.elementId]};this.setUserDefinedLocation=function(t){e[n.elementId]=t};this.getCssClass=function(){return v};this.setCssClass=function(n){v=n}};u.continuousAnchorFactory={get:function(n){return new y(n)},clear:function(n){delete e[n];delete h[n]}}};jsPlumb.Anchor=function(n){this.x=n.x||0;this.y=n.y||0;this.elementId=n.elementId;this.cssClass=n.cssClass||"";this.userDefinedLocation=null;this.orientation=n.orientation||[0,0];jsPlumbUtil.EventGenerator.apply(this);var t=n.jsPlumbInstance;this.lastReturnValue=null;this.offsets=n.offsets||[0,0];this.timestamp=null;this.compute=function(n){var i=n.xy,r=n.wh,u=n.element,t=n.timestamp;return(n.clearUserDefinedLocation&&(this.userDefinedLocation=null),t&&t===self.timestamp)?this.lastReturnValue:(this.lastReturnValue=this.userDefinedLocation!=null?this.userDefinedLocation:[i[0]+this.x*r[0]+this.offsets[0],i[1]+this.y*r[1]+this.offsets[1]],this.timestamp=t,this.lastReturnValue)};this.getCurrentLocation=function(n){return this.lastReturnValue==null||n.timestamp!=null&&this.timestamp!=n.timestamp?this.compute(n):this.lastReturnValue}};jsPlumbUtil.extend(jsPlumb.Anchor,jsPlumbUtil.EventGenerator,{equals:function(n){if(!n)return!1;var t=n.getOrientation(),i=this.getOrientation();return this.x==n.x&&this.y==n.y&&this.offsets[0]==n.offsets[0]&&this.offsets[1]==n.offsets[1]&&i[0]==t[0]&&i[1]==t[1]},getUserDefinedLocation:function(){return this.userDefinedLocation},setUserDefinedLocation:function(n){this.userDefinedLocation=n},clearUserDefinedLocation:function(){this.userDefinedLocation=null},getOrientation:function(){return this.orientation},getCssClass:function(){return this.cssClass}});jsPlumb.FloatingAnchor=function(n){jsPlumb.Anchor.apply(this,arguments);var u=n.reference,s=n.jsPlumbInstance,f=n.referenceCanvas,r=jsPlumb.getSize(f),e=0,o=0,t=null,i=null;this.orientation=null;this.x=0;this.y=0;this.isFloating=!0;this.compute=function(n){var t=n.xy,f=n.element,u=[t[0]+r[0]/2,t[1]+r[1]/2];return i=u,u};this.getOrientation=function(n){if(t)return t;var i=u.getOrientation(n);return[Math.abs(i[0])*e*-1,Math.abs(i[1])*o*-1]};this.over=function(n,i){t=n.getOrientation(i)};this.out=function(){t=null};this.getCurrentLocation=function(n){return i==null?this.compute(n):i}};jsPlumbUtil.extend(jsPlumb.FloatingAnchor,jsPlumb.Anchor);i=function(n,t,i){return n.constructor==jsPlumb.Anchor?n:t.makeAnchor(n,i,t)};jsPlumb.DynamicAnchor=function(n){var r;for(jsPlumb.Anchor.apply(this,arguments),this.isSelective=!0,this.isDynamic=!0,this.anchors=[],this.elementId=n.elementId,this.jsPlumbInstance=n.jsPlumbInstance,r=0;r<n.anchors.length;r++)this.anchors[r]=i(n.anchors[r],this.jsPlumbInstance,this.elementId);this.addAnchor=function(n){this.anchors.push(i(n,this.jsPlumbInstance,this.elementId))};this.getAnchors=function(){return this.anchors};this.locked=!1;var t=this.anchors.length>0?this.anchors[0]:null,s=this.anchors.length>0?0:-1,u=t,f=this,e=function(n,t,i,r,u){var f=r[0]+n.x*u[0],e=r[1]+n.y*u[1],o=r[0]+u[0]/2,s=r[1]+u[1]/2;return Math.sqrt(Math.pow(t-f,2)+Math.pow(i-e,2))+Math.sqrt(Math.pow(o-f,2)+Math.pow(s-e,2))},o=n.selector||function(n,t,i,r,u){for(var o,c=i[0]+r[0]/2,l=i[1]+r[1]/2,s=-1,h=Infinity,f=0;f<u.length;f++)o=e(u[f],c,l,n,t),o<h&&(s=f+0,h=o);return u[s]};this.compute=function(n){var s=n.xy,h=n.wh,c=n.timestamp,r=n.txy,e=n.twh,i;return(this.timestamp=c,i=f.getUserDefinedLocation(),i!=null)?i:this.locked||r==null||e==null?t.compute(n):(n.timestamp=null,t=o(s,h,r,e,this.anchors),this.x=t.x,this.y=t.y,t!=u&&this.fire("anchorChanged",t),u=t,t.compute(n))};this.getCurrentLocation=function(n){return this.getUserDefinedLocation()||(t!=null?t.getCurrentLocation(n):null)};this.getOrientation=function(n){return t!=null?t.getOrientation(n):[0,0]};this.over=function(n,i){t!=null&&t.over(n,i)};this.out=function(){t!=null&&t.out()};this.getCssClass=function(){return t&&t.getCssClass()||""}};jsPlumbUtil.extend(jsPlumb.DynamicAnchor,jsPlumb.Anchor);n=function(n,t,i,r,u,f){jsPlumb.Anchors[u]=function(e){var o=e.jsPlumbInstance.makeAnchor([n,t,i,r,0,0],e.elementId,e.jsPlumbInstance);return o.type=u,f&&f(o,e),o}};n(.5,0,0,-1,"TopCenter");n(.5,1,0,1,"BottomCenter");n(0,.5,-1,0,"LeftMiddle");n(1,.5,1,0,"RightMiddle");n(.5,0,0,-1,"Top");n(.5,1,0,1,"Bottom");n(0,.5,-1,0,"Left");n(1,.5,1,0,"Right");n(.5,.5,0,0,"Center");n(1,0,0,-1,"TopRight");n(1,1,0,1,"BottomRight");n(0,0,0,-1,"TopLeft");n(0,1,0,1,"BottomLeft");jsPlumb.Defaults.DynamicAnchors=function(n){return n.jsPlumbInstance.makeAnchors(["TopCenter","RightMiddle","BottomCenter","LeftMiddle"],n.elementId,n.jsPlumbInstance)};jsPlumb.Anchors.AutoDefault=function(n){var t=n.jsPlumbInstance.makeDynamicAnchor(jsPlumb.Defaults.DynamicAnchors(n));return t.type="AutoDefault",t};t=function(n,t){jsPlumb.Anchors[n]=function(i){var r=i.jsPlumbInstance.makeAnchor(["Continuous",{faces:t}],i.elementId,i.jsPlumbInstance);return r.type=n,r}};jsPlumb.Anchors.Continuous=function(n){return n.jsPlumbInstance.continuousAnchorFactory.get(n)};t("ContinuousLeft",["left"]);t("ContinuousTop",["top"]);t("ContinuousBottom",["bottom"]);t("ContinuousRight",["right"]);n(0,0,0,0,"Assign",function(n,t){var i=t.position||"Fixed";n.positionFinder=i.constructor==String?t.jsPlumbInstance.AnchorPositionFinders[i]:i;n.constructorParams=t});jsPlumbInstance.prototype.AnchorPositionFinders={Fixed:function(n,t,i){return[(n.left-t.left)/i[0],(n.top-t.top)/i[1]]},Grid:function(n,t,i,r){var e=n.left-t.left,o=n.top-t.top,u=i[0]/r.grid[0],f=i[1]/r.grid[1],s=Math.floor(e/u),h=Math.floor(o/f);return[(s*u+u/2)/i[0],(h*f+f/2)/i[1]]}};jsPlumb.Anchors.Perimeter=function(n){var t,i,r,f;if(n=n||{},t=n.anchorCount||60,i=n.shape,!i)throw new Error("no shape supplied to Perimeter Anchor type");var e=function(){for(var f,e,n=.5,o=Math.PI*2/t,i=0,r=[],u=0;u<t;u++)f=n+n*Math.sin(i),e=n+n*Math.cos(i),r.push([f,e,0,0]),i+=o;return r},o=function(n){for(var i=t/n.length,u=[],f=function(n,r,f,e,o){var h,c,s;for(i=t*o,h=(f-n)/i,c=(e-r)/i,s=0;s<i;s++)u.push([n+h*s,r+c*s,0,0])},r=0;r<n.length;r++)f.apply(null,n[r]);return u},u=function(n){for(var i=[],t=0;t<n.length;t++)i.push([n[t][0],n[t][1],n[t][2],n[t][3],1/n.length]);return o(i)},s=function(){return u([[0,0,1,0],[1,0,1,1],[1,1,0,1],[0,1,0,0]])},h={Circle:e,Ellipse:e,Diamond:function(){return u([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]])},Rectangle:s,Square:s,Triangle:function(){return u([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]])},Path:function(n){for(var f,u,i=n.points,r=[],e=0,t=0;t<i.length-1;t++)f=Math.sqrt(Math.pow(i[t][2]-i[t][0])+Math.pow(i[t][3]-i[t][1])),e+=f,r.push([i[t][0],i[t][1],i[t+1][0],i[t+1][1],f]);for(u=0;u<r.length;u++)r[u][4]=r[u][4]/e;return o(r)}},c=function(n,t){for(var u,f,e=[],r=t/180*Math.PI,i=0;i<n.length;i++)u=n[i][0]-.5,f=n[i][1]-.5,e.push([.5+(u*Math.cos(r)-f*Math.sin(r)),.5+(u*Math.sin(r)+f*Math.cos(r)),n[i][2],n[i][3]]);return e};if(!h[i])throw new Error("Shape ["+i+"] is unknown by Perimeter Anchor type");return r=h[i](n),n.rotation&&(r=c(r,n.rotation)),f=n.jsPlumbInstance.makeDynamicAnchor(r),f.type="Perimeter",f}})();
//# sourceMappingURL=anchors.min.js.map
