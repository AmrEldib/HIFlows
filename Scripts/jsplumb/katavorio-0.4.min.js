(function(){"use strict";var a=function(n){var r=n.getBoundingClientRect(),t=document.body,i=document.documentElement,u=window.pageYOffset||i.scrollTop||t.scrollTop,f=window.pageXOffset||i.scrollLeft||t.scrollLeft,e=i.clientTop||t.clientTop||0,o=i.clientLeft||t.clientLeft||0,s=r.top+u-e,h=r.left+f-o;return{top:Math.round(s),left:Math.round(h)}},u=function(n,t,i){var u,r;for(i=i||n.parentNode,u=i.querySelectorAll(t),r=0;r<u.length;r++)if(u[r]===n)return!0;return!1},f=function(){var n=-1,t,i;return navigator.appName=="Microsoft Internet Explorer"&&(t=navigator.userAgent,i=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"),i.exec(t)!=null&&(n=parseFloat(RegExp.$1))),n}(),v=f>-1&&f<9,e=function(n){if(v)return[n.clientX+document.documentElement.scrollLeft,n.clientY+document.documentElement.scrollTop];var i=p(n),t=y(i,0);return[t.pageX,t.pageY]},y=function(n,t){return n.item?n.item(t):n[t]},p=function(n){return n.touches&&n.touches.length>0?n.touches:n.changedTouches&&n.changedTouches.length>0?n.changedTouches:n.targetTouches&&n.targetTouches.length>0?n.targetTouches:[n]},o={draggable:"katavorio-draggable",droppable:"katavorio-droppable",drag:"katavorio-drag",selected:"katavorio-drag-selected",active:"katavorio-drag-active",hover:"katavorio-drag-hover",noSelect:"katavorio-drag-no-select"},w="katavorio-drag-scope",r=["stop","start","drag","drop","over","out"],b=function(){},s=function(){return!0},t=function(n,t,i){for(var r=0;r<n.length;r++)n[r]!=i&&t(n[r])},h=function(n,i,r,u){t(n,function(n){n.setActive(i);i&&n.updatePosition();r&&n.setHover(u,i)})},n=function(n,t){if(n!=null){n=typeof n!="string"&&n.tagName==null&&n.length!=null?n:[n];for(var i=0;i<n.length;i++)t.apply(n[i],[n[i]])}},c=function(n){n.stopPropagation?(n.stopPropagation(),n.preventDefault()):n.returnValue=!1},k="input,textarea,select,button",d=function(n,t,i){var r=n.srcElement||n.target;return!u(r,i.getInputFilterSelector(),t)},l=function(t,i,r,u){this.params=i||{};this.el=t;this.params.addClass(this.el,this._class);var f=!0;return this.setEnabled=function(n){f=n},this.isEnabled=function(){return f},this.toggleEnabled=function(){f=!f},this.setScope=function(n){this.scopes=n?n.split(/\s+/):[u]},this.addScope=function(t){var i={},r;n(this.scopes,function(n){i[n]=!0});n(t?t.split(/\s+/):[],function(n){i[n]=!0});this.scopes=[];for(r in i)this.scopes.push(r)},this.removeScope=function(t){var i={},r;n(this.scopes,function(n){i[n]=!0});n(t?t.split(/\s+/):[],function(n){delete i[n]});this.scopes=[];for(r in i)this.scopes.push(r)},this.toggleScope=function(t){var i={},r;n(this.scopes,function(n){i[n]=!0});n(t?t.split(/\s+/):[],function(n){i[n]?delete i[n]:i[n]=!0});this.scopes=[];for(r in i)this.scopes.push(r)},this.setScope(i.scope),this.k=i.katavorio,i.katavorio},g=function(n,t,i){var o,k,f,y;this._class=i.draggable;o=l.apply(this,arguments);this.rightButtonCanDrag=this.params.rightButtonCanDrag;var v=[0,0],p=null,w=!1,rt=this.params.consumeStartEvent!==!1,r=this.el,g=this.params.clone;this.toGrid=function(n){return this.params.grid==null?n:[this.params.grid[0]*Math.floor(n[0]/this.params.grid[0]),this.params.grid[1]*Math.floor(n[1]/this.params.grid[1])]};this.constrain=typeof this.params.constrain=="function"?this.params.constrain:this.params.constrain||this.params.containment?function(n){return[Math.max(0,Math.min(k.w-this.size[0],n[0])),Math.max(0,Math.min(k.h-this.size[1],n[1]))]}:function(n){return n};var nt=s,tt="",b=this.params.filterExclude!==!1,it=this.setFilter=function(t,i){t&&(tt=t,b=i!==!1,nt=function(i){var f=i.srcElement||i.target,r=u(f,t,n);return b?!r:r})};this.canDrag=this.params.canDrag||s;f=[];y=[];this.downListener=function(n){var f=this.rightButtonCanDrag||n.which!==3&&n.button!==2,u,t;f&&this.isEnabled()&&this.canDrag()&&(u=nt(n)&&d(n,this.el,this.k),u?(g?(r=this.el.cloneNode(!0),r.setAttribute("id",null),r.style.position="absolute",t=a(this.el),r.style.left=t.left+"px",r.style.top=t.top+"px",document.body.appendChild(r)):r=this.el,rt&&c(n),v=e(n),this.params.bind(document,"mousemove",this.moveListener),this.params.bind(document,"mouseup",this.upListener),o.markSelection(this),this.params.addClass(document.body,i.noSelect)):this.params.consumeFilteredEvents&&c(n))}.bind(this);this.moveListener=function(n){if(v){w||(this.params.events.start({el:this.el,pos:p,e:n,drag:this}),this.mark(),w=!0);y.length=0;var r=e(n),t=r[0]-v[0],i=r[1]-v[1],u=this.params.ignoreZoom?1:o.getZoom();t/=u;i/=u;this.moveBy(t,i,n);o.updateSelection(t,i,this)}}.bind(this);this.upListener=function(n){v=null;w=!1;this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.params.removeClass(document.body,i.noSelect);this.unmark(n);o.unmarkSelection(this,n);this.stop(n);o.notifySelectionDragStop(this,n);g&&(r&&r.parentNode&&r.parentNode.removeChild(r),r=null)}.bind(this);this.getFilter=function(){return tt};this.isFilterExclude=function(){return b};this.abort=function(){v!=null&&this.upListener()};this.getDragElement=function(){return r||this.el};this.stop=function(n){this.params.events.stop({el:r,pos:this.params.getPosition(r),e:n,drag:this})};this.mark=function(){if(p=this.params.getPosition(r),this.size=this.params.getSize(r),f=o.getMatchingDroppables(this),h(f,!0,!1,this),this.params.addClass(r,this.params.dragClass||i.drag),this.params.constrain||this.params.containment){var n=this.params.getSize(r.parentNode);k={w:n[0],h:n[1]}}};this.unmark=function(n){h(f,!1,!0,this);f.length=0;for(var t=0;t<y.length;t++)y[t].drop(this,n)};this.moveBy=function(n,t,i){var e,o,u,s;for(y.length=0,e=this.constrain(this.toGrid([p[0]+n,p[1]+t]),r),o={x:e[0],y:e[1],w:this.size[0],h:this.size[1]},this.params.setPosition(r,e),u=0;u<f.length;u++)s={x:f[u].position[0],y:f[u].position[1],w:f[u].size[0],h:f[u].size[1]},this.params.intersects(o,s)&&f[u].canDrop(this)?(y.push(f[u]),f[u].setHover(this,!0,i)):f[u].el._katavorioDragHover&&f[u].setHover(this,!1,i);this.params.events.drag({el:this.el,pos:e,e:i,drag:this})};this.destroy=function(){this.params.unbind(this.el,"mousedown",this.downListener);this.params.unbind(document,"mousemove",this.moveListener);this.params.unbind(document,"mouseup",this.upListener);this.downListener=null;this.upListener=null;this.moveListener=null};this.params.bind(this.el,"mousedown",this.downListener);this.params.handle?it(this.params.handle,!1):it(this.params.filter,this.params.filterExclude)},nt=function(n,t,i){this._class=i.droppable;this.params=t||{};this._activeClass=t.activeClass||i.active;this._hoverClass=t.hoverClass||i.hover;l.apply(this,arguments);var r=!1;this.setActive=function(n){this.params[n?"addClass":"removeClass"](this.el,this._activeClass)};this.updatePosition=function(){this.position=this.params.getPosition(this.el);this.size=this.params.getSize(this.el)};this.canDrop=this.params.canDrop||function(){return!0};this.setHover=function(n,t,i){(t||this.el._katavorioDragHover==null||this.el._katavorioDragHover==n.el._katavorio)&&(this.params[t?"addClass":"removeClass"](this.el,this._hoverClass),this.el._katavorioDragHover=t?n.el._katavorio:null,r!==t&&this.params.events[t?"over":"out"]({el:this.el,e:i,drag:n,drop:this}),r=t)};this.drop=function(n,t){this.params.events.drop({drag:n,e:t,drop:this})};this.destroy=function(){this._class=null;this._activeClass=null;this._hoverClass=null;r=null}},tt=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})},i=function(n){return n==null?null:(n=typeof n=="string"?document.getElementById(n):n,n==null)?null:(n._katavorio=n._katavorio||tt(),n)};this.Katavorio=function(u){var f=[],s={},h,a,c,v;this._dragsByScope={};this._dropsByScope={};var y=1,l=function(n,t){for(var i=0;i<n.scopes.length;i++)t[n.scopes[i]]=t[n.scopes[i]]||[],t[n.scopes[i]].push(n)},p=function(n,t){for(var r,f=0,i=0;i<n.scopes.length;i++)t[n.scopes[i]]&&(r=u.indexOf(t[n.scopes[i]],n),r!=-1&&(t[n.scopes[i]].splice(r,1),f++));return f>0},rt=this.getMatchingDroppables=function(n){for(var t,i,u=[],f={},r=0;r<n.scopes.length;r++)if(t=this._dropsByScope[n.scopes[r]],t)for(i=0;i<t.length;i++)t[i].canDrop(n)&&!f[t[i].el._katavorio]&&t[i].el!==n.el&&(f[t[i].el._katavorio]=!0,u.push(t[i]));return u},d=function(n){var i,t;n=n||{};i={events:{}};for(t in u)i[t]=u[t];for(t in n)i[t]=n[t];for(t=0;t<r.length;t++)i.events[r[t]]=n[r[t]]||b;return i.katavorio=this,i}.bind(this),e={},tt=u.css||{},it=u.scope||w;for(h in o)e[h]=o[h];for(h in tt)e[h]=tt[h];a=u.inputFilterSelector||k;this.getInputFilterSelector=function(){return a};this.setInputFilterSelector=function(n){return a=n,this};this.draggable=function(t,r){var f=[];return n(t,function(n){if(n=i(n),n!=null){var t=d(r);n._katavorioDrag=new g(n,t,e,it);l(n._katavorioDrag,this._dragsByScope);f.push(n._katavorioDrag);u.addClass(n,e.draggable)}}.bind(this)),f};this.droppable=function(t,r){var f=[];return n(t,function(n){n=i(n);n!=null&&(n._katavorioDrop=new nt(n,d(r),e,it),l(n._katavorioDrop,this._dropsByScope),f.push(n._katavorioDrop),u.addClass(n,e.droppable))}.bind(this)),f};this.select=function(t){return n(t,function(){var n=i(this);n&&n._katavorioDrag&&(s[n._katavorio]||(f.push(n._katavorioDrag),s[n._katavorio]=[n,f.length-1],u.addClass(n,e.selected)))}),this};this.deselect=function(t){return n(t,function(){var n=i(this),o,r,t;if(n&&n._katavorio&&(o=s[n._katavorio],o)){for(r=[],t=0;t<f.length;t++)f[t].el!==n&&r.push(f[t]);f=r;delete s[n._katavorio];u.removeClass(n,e.selected)}}),this};this.deselectAll=function(){var n,t;for(n in s)t=s[n],u.removeClass(t[0],e.selected);f.length=0;s={}};this.markSelection=function(n){t(f,function(n){n.mark()},n)};this.unmarkSelection=function(n,i){t(f,function(n){n.unmark(i)},n)};this.getSelection=function(){return f.slice(0)};this.updateSelection=function(n,i,r){t(f,function(t){t.moveBy(n,i)},r)};this.notifySelectionDragStop=function(n,i){t(f,function(n){n.stop(i)},n)};this.setZoom=function(n){y=n};this.getZoom=function(){return y};c=function(n,t,i,r){n!=null&&(p(n,i),n[r](t),l(n,i))};n(["set","add","remove","toggle"],function(n){this[n+"Scope"]=function(t,i){c(t._katavorioDrag,i,this._dragsByScope,n+"Scope");c(t._katavorioDrop,i,this._dropsByScope,n+"Scope")}.bind(this);this[n+"DragScope"]=function(t,i){c(t._katavorioDrag,i,this._dragsByScope,n+"Scope")}.bind(this);this[n+"DropScope"]=function(t,i){c(t._katavorioDrop,i,this._dropsByScope,n+"Scope")}.bind(this)}.bind(this));this.getDragsForScope=function(n){return this._dragsByScope[n]};this.getDropsForScope=function(n){return this._dropsByScope[n]};v=function(n,t,r){n=i(n);n[t]&&(p(n[t],r)&&n[t].destroy(),n[t]=null)};this.elementRemoved=function(n){this.destroyDraggable(n);this.destroyDroppable(n)};this.destroyDraggable=function(n){v(n,"_katavorioDrag",this._dragsByScope)};this.destroyDroppable=function(n){v(n,"_katavorioDrop",this._dropsByScope)}}}).call(this);
//# sourceMappingURL=katavorio-0.4.min.js.map
